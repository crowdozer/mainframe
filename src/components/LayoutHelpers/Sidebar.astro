---
import SidebarContent from './SidebarContent.astro'

import { Icon } from 'astro-icon'
---

<!-- floating button to open sidebar -->
<div class="fixed bottom-0 right-0 z-[990] lg:hidden">
	<button
		id="btn-open-sidebar"
		class="-mb-8 mr-8 rotate-90 border border-neutral-400 bg-neutral-950 px-4 py-2 hover:bg-neutral-900 active:bg-neutral-800"
	>
		<p class="flex flex-row gap-4">
			<span class="self-center">sidebar</span>
			<Icon name="mdi:menu" width="2rem" />
		</p>
	</button>
</div>

<!-- the sidebar itself -->
<aside
	id="sidebar"
	class="fixed bottom-0 left-0 right-0 top-0 z-[999] bg-neutral-950 p-2 lg:contents lg:p-0"
	data-open="0"
>
	<!-- give the button a dedicated slot at the bottom -->
	<div class="flex h-full flex-col">
		<!-- sidebar content area -->
		<div
			id="sidebar-content-scroll"
			class="flex grow flex-col gap-4 overflow-y-auto overflow-x-hidden"
		>
			<SidebarContent />
		</div>

		<!-- close button -->
		<div class="mt-2 block border-t border-neutral-400 pt-2 lg:hidden">
			<button
				id="btn-close-sidebar"
				class="w-full bg-neutral-900 px-4 py-2 hover:bg-neutral-800 active:bg-neutral-700"
			>
				{'< back to page'}
			</button>
		</div>
	</div>
</aside>

<script>
	const openBtn = document.getElementById('btn-open-sidebar')
	const closeBtn = document.getElementById('btn-close-sidebar')
	const sidebar = document.getElementById('sidebar')
	const content = document.getElementById('sidebar-content-scroll')

	openBtn?.addEventListener('click', function () {
		sidebar?.setAttribute('data-open', '1')
		content?.scrollTo({
			top: 0,
			left: 0,
			behavior: 'smooth',
		})
	})

	closeBtn?.addEventListener('click', function () {
		const state = sidebar?.getAttribute('data-open')

		if (state === '0') {
			sidebar?.setAttribute('data-open', '1')
			document.body.classList.add('overflow-y-hidden')
		} else {
			sidebar?.setAttribute('data-open', '0')
			document.body.classList.remove('overflow-y-hidden')
		}
	})
</script>

<style>
	#sidebar[data-open='0'] {
		@apply hidden lg:contents;
	}
	#sidebar[data-open='1'] {
		@apply block lg:contents;
	}
	#btn-open-sidebar {
		transform-origin: 100% 0;
	}
</style>
