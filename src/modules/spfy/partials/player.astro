---
/**
    wherever this component is included, the following must be exported:

	export const partial = true
	export const prerender = false
 */

import Renderer from '../components/Renderer.astro'
import RendererInactive from '../components/RendererInactive.astro'
import { getPlaybackState } from '../utils/client'

const { playing, date } = await getPlaybackState()

// infer the actual track state, based on the datetime the
// status was updatedon  vs the datetime we're currently at
const now = new Date()
const delta = now.getTime() - date.getTime()
---

{
	playing.is_playing && playing && playing.item && playing.item.album ? (
		<Renderer
			duration={playing.item.duration_ms}
			progress={playing.progress_ms + delta}
			albumText={playing.item.album.name}
			songText={playing.item.name}
			artistText={playing.item.artists.map((a: any) => a.name).join(', ')}
			url={playing.item.preview_url}
			image={playing.item.album.images[0].url}
		/>
	) : (
		<RendererInactive />
	)
}
